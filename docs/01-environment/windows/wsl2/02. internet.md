---
title: 02. 网络问题
---

## 如何将网络可以局域网内访问

关于这部分网上其实有很多解决方案，但主要的是以端口转发或者bridge方式为主。但经过笔者实践，笔者认为并不是很方便。

- wsl2 对于程序员来说大部分情况下可能作为开发环境使用，因此即便暴露全部端口也不会有什么安全问题
- 由于项目原因，端口号可能并不固定，因此每次都需要重新调整。特别是局域网ip发生变化后。

因此经过笔者不断搜索资料找到了一种方式：通过**镜像网络的方式**，此时wsl2的网络与宿主一致，官方文档：[镜像模式网络](https://learn.microsoft.com/zh-cn/windows/wsl/networking#mirrored-mode-networking)

笔者只有一台wsl机器用作开发，因此选择的方式是直接从全局的[wsl配置文件](https://learn.microsoft.com/zh-cn/windows/wsl/wsl-config#configuration-settings-for-wslconfig)`.wslconfig`进行配置。

```ini
[experimental]
networkingMode=mirrored
dnsTunneling=true
firewall=true
autoProxy=true
hostAddressLoopback=true
```

具体其他配置字段参考：https://learn.microsoft.com/zh-cn/windows/wsl/wsl-config#main-wsl-settings

此时不出意外则可以在宿主机通过局域网ip进行访问，但是如果开启了防火墙那么在其他机器中还是无法访问，此时需要放行防火墙。

> 在 PowerShell 窗口中以管理员权限运行以下命令，以配置 Hyper-V 防火墙设置，使其允许入站连接：
>
> ```powershell
> Set-NetFirewallHyperVVMSetting -Name '{40E0AC32-46A5-438A-A0B2-2B479E8F2E90}' -DefaultInboundAction Allow
> ```
>
> 或
>
> ```powershell
> New-NetFirewallHyperVRule -Name "MyWebServer" -DisplayName "My Web Server" -Direction Inbound -VMCreatorId '{40E0AC32-46A5-438A-A0B2-2B479E8F2E90}' -Protocol TCP -LocalPorts 80
> ```

另外还可以手动在防火墙处添加端口进行放行
